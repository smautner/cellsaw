from lmz import Map,Zip,Filter,Grouper,Range,Transpose,Flatten
import matplotlib
matplotlib.use('module://matplotlib-sixel')
from matplotlib import pyplot as plt
import ubergauss.tools as ut
import wrappers
import dirtyopts
import seaborn as sns
import pandas as pd



# 1::::  8 dim CMP
def plot_8dim(data,fname = f''):
    data2 = pd.DataFrame(data)
    data2["rank"] = data2.groupby(["test", 'silhouette', 'batchmix', f'dataset'])["score"].rank(method="dense", ascending=True)
    g = sns.FacetGrid(data2, col="silhouette", row="batchmix" )
    g.map_dataframe(sns.barplot, x="test", y = 'rank', hue = 'algo', palette = 'husl')
    plt.legend()
    if fname:
        plt.savefig(fname)
    plt.show()


def collect_8dim():
    d = wrappers.evaluate(path = f'/home/ubuntu/data/yoda/8outscib/', numds =4)
    ut.dumpfile(d,f'scbi_del')
    e = wrappers.evaluate(path = f'/home/ubuntu/data/yoda/8outts/', numds =7)
    ut.dumpfile(e,f'ts_del')
    return d,e

def basic_8dim():
    d,e  = Map(ut.loadfile,f'scbi_del ts_del'.split())
    plot_8dim(d, f'8d_scib.png')
    plot_8dim(e, f'8d_ts.png')




# 2. see the effect on training run and samplin
def plot_var(data,fname = f''):
    data2 = pd.DataFrame(data)
    data2["rank"] = data2.groupby(["test", 'silhouette', 'batchmix', f'dataset'])["score"].rank(method="dense", ascending=True)
    g = sns.FacetGrid(data2, col="silhouette", row="batchmix" )
    g.map_dataframe(sns.barplot, x="test", y = 'score', hue = 'algo', palette = 'husl')
    plt.legend()
    if fname:
        plt.savefig(fname)
    plt.show()

# 2. see the effect on training run and samplin
def plot_var2(data,fname = f''):
    data2 = pd.DataFrame(data)
    data2["rank"] = data2.groupby(["test", 'silhouette', 'batchmix', f'dataset'])["score"].rank(method="dense", ascending=True)
    g = sns.FacetGrid(data2, col="dataset")
    g.map_dataframe(sns.barplot, x="test", y = 'score', hue = 'algo', palette = 'husl')
    plt.legend()
    if fname:
        plt.savefig(fname)
    plt.show()

def collect_variance():
    # a = wrappers.evaluate(path = f'/home/ubuntu/data/yoda/8outscib/', numds =4, mnn=False)
    # b = wrappers.evaluate(path = f'/home/ubuntu/data/yoda/scib_odata/', numds =4, mnn=False)
    # ut.dumpfile((a,b), f'var_del')
    a,b = ut.loadfile( f'var_del')
    def fix(x,algo=f''):
        x[f'algo'] = algo
    c  = [{'dataset': 1, 'score': 0.51384, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 1, 'score': -0.057082985, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 1, 'score': -0.32984, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 1, 'score': 0.53626, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 1, 'score': -0.056768086, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 1, 'score': -0.34432, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 1, 'score': 0.50874, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 1, 'score': -0.05680238, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 1, 'score': -0.31764, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 1, 'score': 0.56776, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 1, 'score': -0.05080069, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 1, 'score': -0.41668, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 1, 'score': 0.53052, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 1, 'score': -0.056096856, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 1, 'score': -0.35274, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 1, 'score': 0.57604, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 1, 'score': -0.050691277, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 1, 'score': -0.41672, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 1, 'score': 0.5451, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 1, 'score': -0.053716835, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 1, 'score': -0.36118, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 1, 'score': 0.58798, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 1, 'score': -0.050838415, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 1, 'score': -0.45256, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 1, 'score': 0.52724, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 1, 'score': -0.057751324, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 1, 'score': -0.33914, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 0, 'score': 0.57528, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 0, 'score': -0.061074976, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 0, 'score': -0.42128, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 0, 'score': 0.60206, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 0, 'score': -0.058978096, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 0, 'score': -0.53822, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 0, 'score': 0.59564, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 0, 'score': -0.059482, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 0, 'score': -0.58478, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 0, 'score': 0.54644, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 0, 'score': -0.06826098, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 0, 'score': -0.38096, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 0, 'score': 0.54172, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 0, 'score': -0.06666204, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 0, 'score': -0.35556, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 0, 'score': 0.52816, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 0, 'score': -0.06783369, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 0, 'score': -0.34734, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 0, 'score': 0.56536, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 0, 'score': -0.064807504, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 0, 'score': -0.4021, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 0, 'score': 0.49846, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 0, 'score': -0.068741634, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 0, 'score': -0.2984, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 0, 'score': 0.53476, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 0, 'score': -0.06624272, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 0, 'score': -0.3467, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 2, 'score': 0.26444, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 2, 'score': -0.22200185, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 2, 'score': -0.93086, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 2, 'score': 0.2723, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 2, 'score': -0.2184093, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 2, 'score': 0.27102, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 2, 'score': -0.27798942, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 2, 'score': 0.27354, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 2, 'score': -0.22141688, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 2, 'score': 0.27134, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 2, 'score': -0.23009959, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 2, 'score': 0.27508, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 2, 'score': -0.22598186, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 2, 'score': 0.27438, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 2, 'score': -0.26705453, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 2, 'score': 0.27188, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 2, 'score': -0.23880728, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 2, 'score': 0.2679, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 2, 'score': -0.2186622, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 3, 'score': 0.38004444444444446, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 3, 'score': -0.13494569, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 3, 'score': -0.45444444444444443, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 3, 'score': 0.40657777777777776, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 3, 'score': -0.11990353, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 3, 'score': -0.5611333333333334, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 3, 'score': 0.48804444444444445, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 3, 'score': -0.15307873, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 3, 'score': -0.9581555555555555, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 3, 'score': 0.3661111111111111, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 3, 'score': -0.0952982, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 3, 'score': -0.38206666666666667, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 3, 'score': 0.4459111111111111, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 3, 'score': -0.11065644, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 3, 'score': -0.7367333333333334, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 3, 'score': 0.39437777777777777, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 3, 'score': -0.15209274, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 3, 'score': -0.4988666666666667, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 3, 'score': 0.37162222222222224, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 3, 'score': -0.1351405, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 3, 'score': -0.416, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 3, 'score': 0.40326666666666666, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 3, 'score': -0.12417296, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 3, 'score': -0.5407555555555555, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 3, 'score': 0.38008888888888887, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 3, 'score': -0.13562918, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 3, 'score': -0.4444, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}]
    d = [{'dataset': 1, 'score': 0.51512, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 1, 'score': -0.057312712, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 1, 'score': -0.33002, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 1, 'score': 0.53436, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 1, 'score': -0.056682568, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 1, 'score': -0.34514, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 1, 'score': 0.51142, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 1, 'score': -0.056215398, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 1, 'score': -0.32214, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 1, 'score': 0.56636, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 1, 'score': -0.051119752, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 1, 'score': -0.41508, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 1, 'score': 0.52984, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 1, 'score': -0.056169465, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 1, 'score': -0.35276, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 1, 'score': 0.57554, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 1, 'score': -0.050100233, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 1, 'score': -0.41134, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 1, 'score': 0.54592, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 1, 'score': -0.05386522, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 1, 'score': -0.36124, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 1, 'score': 0.5885, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 1, 'score': -0.050400056, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 1, 'score': -0.44848, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 1, 'score': 0.5259, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 1, 'score': -0.057550684, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 1, 'score': -0.33922, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 0, 'score': 0.57522, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 0, 'score': -0.060494084, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 0, 'score': -0.42368, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 0, 'score': 0.59782, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 0, 'score': -0.059131347, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 0, 'score': -0.53972, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 0, 'score': 0.59954, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 0, 'score': -0.059595544, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 0, 'score': -0.60158, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 0, 'score': 0.55348, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 0, 'score': -0.066324644, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 0, 'score': -0.39382, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 0, 'score': 0.54254, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 0, 'score': -0.0663735, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 0, 'score': -0.35782, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 0, 'score': 0.53142, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 0, 'score': -0.06730194, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 0, 'score': -0.34398, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 0, 'score': 0.56246, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 0, 'score': -0.0650724, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 0, 'score': -0.40038, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 0, 'score': 0.4984, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 0, 'score': -0.06886835, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 0, 'score': -0.29576, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 0, 'score': 0.53002, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 0, 'score': -0.06569605, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 0, 'score': -0.33724, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 2, 'score': 0.2641, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 2, 'score': -0.21888447, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 2, 'score': -0.93106, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 2, 'score': 0.2702, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 2, 'score': -0.22239952, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 2, 'score': 0.27212, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 2, 'score': -0.26958352, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 2, 'score': 0.27436, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 2, 'score': -0.2265874, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 2, 'score': 0.2694, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 2, 'score': -0.23359752, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 2, 'score': 0.27108, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 2, 'score': -0.21895137, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 2, 'score': 0.27318, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 2, 'score': -0.26544243, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 2, 'score': 0.27616, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 2, 'score': -0.2393032, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 2, 'score': 0.2719, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 2, 'score': -0.2212072, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 2, 'score': -1.0, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 3, 'score': 0.3803111111111111, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 3, 'score': -0.14537482, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 3, 'score': -0.4527777777777778, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 10}, {'dataset': 3, 'score': 0.40553333333333336, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 3, 'score': -0.1223334, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 3, 'score': -0.5734444444444444, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 15}, {'dataset': 3, 'score': 0.4908222222222222, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 3, 'score': -0.15195209, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 3, 'score': -0.9629333333333333, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.5, 'silhouette': 20}, {'dataset': 3, 'score': 0.35864444444444443, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 3, 'score': -0.10336733, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 3, 'score': -0.38651111111111114, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 10}, {'dataset': 3, 'score': 0.4417333333333333, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 3, 'score': -0.1212197, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 3, 'score': -0.7392, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 15}, {'dataset': 3, 'score': 0.39584444444444444, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 3, 'score': -0.14291322, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 3, 'score': -0.5016222222222222, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.6, 'silhouette': 20}, {'dataset': 3, 'score': 0.37104444444444445, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 3, 'score': -0.13332704, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 3, 'score': -0.4136888888888889, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 10}, {'dataset': 3, 'score': 0.4078888888888889, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 3, 'score': -0.13886091, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 3, 'score': -0.5467111111111111, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 15}, {'dataset': 3, 'score': 0.3794, 'test': 'label', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 3, 'score': -0.14193377, 'test': 'shilouette', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}, {'dataset': 3, 'score': -0.4444888888888889, 'test': 'batchmix', 'algo': 'lucy', 'label': 1, 'batchmix': 0.7, 'silhouette': 20}]
    Map(fix, a, algo = f'p1_resampled' )
    Map(fix, b, algo = f'p1_origdata' )
    Map(fix, c, algo = f'p2_origdata' )
    Map(fix, d, algo = f'p2_resample' )
    plot_var2(a+b+c+d, f'varplot.png')


# 3. paired evaluation ...
def plot_pair(data,fname = f''):
    data2 = pd.DataFrame(data)
    data2["rank"] = data2.groupby(["test", 'silhouette', 'batchmix', f'dataset'])["pair score"].rank(method="dense", ascending=True)
    g = sns.FacetGrid(data2, col="silhouette", row="batchmix" )
    g.map_dataframe(sns.barplot, x="test", y = 'rank', hue = 'algo', palette = 'husl')
    plt.legend()
    if fname:
        plt.savefig(fname)
    plt.show()

def plot_pair2(data,fname = f''):
    plt.close()
    data2 = pd.DataFrame(data)
    # data2["rank"] = data2.groupby(["test", 'silhouette', 'batchmix'])["pair score"].rank(method="dense", ascending=True)
    data2["rank"] = data2.groupby(["test", 'dataset'])["pair score"].rank(method="dense", ascending=True)
    pd.set_option('display.max_rows', 500)
    print(data2)
    sns.barplot(data = data2, x = 'test', y = 'rank', hue = 'algo')
    plt.legend()
    if fname:
        plt.savefig(fname)
    plt.show()

def collect_pairthing():
    # d,e  = Map(ut.loadfile,f'scbi_del ts_del'.split())
    e=  ut.loadfile( f'pairsc_del')
    # a = wrappers.evaluate(path = f'/home/ubuntu/data/yoda/8outscib/', numds =4, mnn=False)
    # b = wrappers.evaluate(path = f'/home/ubuntu/data/yoda/scib_odata/', numds =4, mnn=False)
    # ut.dumpfile((a,b), f'var_del')
    plot_pair2(e, f'pair_union.png')
    plot_pair(e, f'pair_split.png')





# SANKEY

# DUMP som infos namely now many neighs we should connect
def inspect_ladderusage():
    d = ut.loadfile('/home/ubuntu/data/yoda/8outts/params2.delme')
    d = [a[0] for a in d]
    for a in d:
        if a[f'use_ladder']:
            print(f"{a[f'connect'] = }")
        else:
            print(f"{a[f'connect_ladder'] = }")




